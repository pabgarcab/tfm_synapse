{
	"name": "SP Backup",
	"properties": {
		"content": {
			"query": "-- EXEC bk.LoadDim\n-- ==============================================================================\n-- Procedimiento almacenado para cargar las dimensiones en la BBDD Backup \n-- ==============================================================================\n\nCREATE OR ALTER PROCEDURE bk.LoadDim\nWITH ENCRYPTION AS \n\n\n---------------\n-- Articles --\n---------------\n-- DROP EXTERNAL TABLE  bk.dim_Articles\n\n-- IF EXISTS ( SELECT * FROM sys.external_tables WHERE object_id = OBJECT_ID('bk.dim_Articles') ) AND ( SELECT * FROM GoldenlessDWH.sys.external_tables WHERE object_id = OBJECT_ID('dim.Articles') )\n--     DROP EXTERNAL TABLE bk.dim_Articles;\n\n-- Darle otra vuelta para hace check de DWH antes del DROP en otra tarea \n\nIF EXISTS (\n    SELECT *  FROM sys.external_tables  WHERE object_id = OBJECT_ID('bk.dim_Articles') ) \nAND \n    EXISTS (\n    SELECT * FROM GoldenlessDWH.sys.external_tables WHERE object_id = OBJECT_ID('dim.Articles') )\nBEGIN\n    DROP EXTERNAL TABLE bk.dim_Articles;\nEND;\n\n\n\nCREATE EXTERNAL TABLE  bk.dim_Articles \nWITH\n(\n\tLOCATION = 'gold/Backup/Articles', \n\tDATA_SOURCE = datalake1pgc,\n\tFILE_FORMAT = ParquetFileFormat\n    \n) AS \n\n    SELECT *\n    FROM [GoldenlessDWH].[dim].[Articles]\n    ORDER BY idSkArticles\n\n---------------\n-- Currency --\n---------------\n-- DROP EXTERNAL TABLE  bk.dim_Currency\n\nIF EXISTS ( SELECT * FROM sys.external_tables WHERE object_id = OBJECT_ID('bk.dim_Currency') )\n    DROP EXTERNAL TABLE bk.dim_Currency;\n\nCREATE EXTERNAL TABLE  bk.dim_Currency \nWITH\n(\n\tLOCATION = 'gold/Backup/Currency', \n\tDATA_SOURCE = datalake1pgc,\n\tFILE_FORMAT = ParquetFileFormat\n) AS \n\n    SELECT *\n    FROM [GoldenlessDWH].[dim].[Currency]\n    ORDER BY idSkCurrency\n\n------------\n-- Client --\n------------\n--DROP EXTERNAL TABLE  bk.dim_Client\n\nIF EXISTS ( SELECT * FROM sys.external_tables WHERE object_id = OBJECT_ID('bk.dim_Client') )\n   DROP EXTERNAL TABLE bk.dim_Client   \n\nCREATE EXTERNAL TABLE  bk.dim_Client \nWITH\n(\n\tLOCATION = 'gold/Backup/Client', \n\tDATA_SOURCE = datalake1pgc,\n\tFILE_FORMAT = ParquetFileFormat\n) AS \n\n    SELECT *\n    FROM [GoldenlessDWH].[dim].[Client]\n    ORDER BY idSkClient\n\n----------\n-- Date --\n----------\n--DROP EXTERNAL TABLE  bk.dim_Date \n\nIF EXISTS ( SELECT * FROM sys.external_tables WHERE object_id = OBJECT_ID('bk.dim_Date') )\n   DROP EXTERNAL TABLE bk.dim_Date;  \n\nCREATE EXTERNAL TABLE  bk.dim_Date \nWITH\n(\n\tLOCATION = 'gold/Backup/Date', \n\tDATA_SOURCE = datalake1pgc,\n\tFILE_FORMAT = ParquetFileFormat\n) AS \n\n    SELECT *\n    FROM [GoldenlessDWH].[dim].[Date]\n    ORDER BY idSkDate\n\n---------------\n-- Hours --\n---------------\n-- DROP EXTERNAL TABLE  bk.dim_Hours\n\nIF EXISTS ( SELECT * FROM sys.external_tables WHERE object_id = OBJECT_ID('bk.dim_Hours') )\n   DROP EXTERNAL TABLE bk.dim_Hours;   \n\nCREATE EXTERNAL TABLE  bk.dim_Hours \nWITH\n(\n\tLOCATION = 'gold/Backup/Hours', \n\tDATA_SOURCE = datalake1pgc,\n\tFILE_FORMAT = ParquetFileFormat\n) AS \n\n    SELECT *\n    FROM [GoldenlessDWH].[dim].[Hours]\n    ORDER BY idSkHours\n\n-------------------\n-- OperationType --\n-------------------\n-- DROP EXTERNAL TABLE  bk.dim_OperationType \n\nIF EXISTS ( SELECT * FROM sys.external_tables WHERE object_id = OBJECT_ID('bk.dim_OperationType') )\n   DROP EXTERNAL TABLE bk.dim_OperationType;   \n\nCREATE EXTERNAL TABLE  bk.dim_OperationType \nWITH\n(\n\tLOCATION = 'gold/Backup/OperationType', \n\tDATA_SOURCE = datalake1pgc,\n\tFILE_FORMAT = ParquetFileFormat\n) AS \n\n    SELECT *\n    FROM [GoldenlessDWH].[dim].[OperationType]\n    ORDER BY idSkOperationType\n\n-----------------\n-- PostalCodes --\n-----------------\n--DROP EXTERNAL TABLE  bk.dim_PostalCodes \n\nIF EXISTS ( SELECT * FROM sys.external_tables WHERE object_id = OBJECT_ID('bk.dim_PostalCodes') )\n    DROP EXTERNAL TABLE bk.dim_PostalCodes; \n\nCREATE EXTERNAL TABLE  bk.dim_PostalCodes \nWITH\n(\n\tLOCATION = 'gold/Backup/PostalCodes', \n\tDATA_SOURCE = datalake1pgc,\n\tFILE_FORMAT = ParquetFileFormat\n) AS \n\n    SELECT *\n    FROM [GoldenlessDWH].[dim].[PostalCodes]\n    ORDER BY idSkPostalCodes\n\n\n------------\n-- Tariff --\n------------\n--DROP EXTERNAL TABLE  bk.dim_Tariff \n\nIF EXISTS ( SELECT * FROM sys.external_tables WHERE object_id = OBJECT_ID('bk.dim_Tariff') )\n   DROP EXTERNAL TABLE bk.dim_Tariff;   \n\nCREATE EXTERNAL TABLE  bk.dim_Tariff \nWITH\n(\n\tLOCATION = 'gold/Backup/Tariff', \n\tDATA_SOURCE = datalake1pgc,\n\tFILE_FORMAT = ParquetFileFormat\n) AS \n\n    SELECT *\n    FROM [GoldenlessDWH].[dim].[Tariff]\n    ORDER BY idSkTariff\n\n---------------\n-- Warehouse --\n---------------\n-- DROP EXTERNAL TABLE  bk.dim_Warehouse \n\nIF EXISTS ( SELECT * FROM sys.external_tables WHERE object_id = OBJECT_ID('bk.dim_Warehouse') )\n   DROP EXTERNAL TABLE bk.dim_Warehouse;   \n\nCREATE EXTERNAL TABLE  bk.dim_Warehouse \nWITH\n(\n\tLOCATION = 'gold/Backup/Warehouse', \n\tDATA_SOURCE = datalake1pgc,\n\tFILE_FORMAT = ParquetFileFormat\n) AS \n    SELECT *\n    FROM [GoldenlessDWH].[dim].[Warehouse]\n    ORDER BY idSkWarehouse\n\n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "BackuplessDB",
				"poolName": "Built-in"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}